<!doctype html>
<html>

<head>
    <script type="text/javascript" src="/homey.js" data-origin="settings"></script>
</head>

<body>
    <h1 data-i18n="settings.title"></h1>

    <div class="field row">
        <label for="ufv_nvr_ip" data-i18n="nvr.description"></label>
        <input id="ufv_nvr_ip" type="text" value="" />
    </div>
    <div class="field row">
        <label for="ufv_apikey" data-i18n="settings.apikey"></label>
        <input id="ufv_apikey" type="text" value="" />
    </div>
    <button id="apply" class="right" data-i18n="settings.apply"></button>

    <script type="text/javascript">
        var txtNvrIp = document.getElementById('ufv_nvr_ip');
        var txtApiKey = document.getElementById('ufv_apikey');
        var btnApply = document.getElementById('apply');

        function onHomeyReady(Homey) {
            Homey.ready();

            function getValues() {
                Homey.get('ufv_nvr', function (err, nvr) {
                    if (err) {
                        return Homey.alert(err);
                    }

                    if (nvr) {
                        txtNvrIp.value = nvr.ip;
                    } else {
                        console.log('[SETTINGS] NVR unavailable.');
                    }
                });

                Homey.get('ufv_apikey', function (err, apiKey) {
                    if (err) {
                        return Homey.alert(err);
                    }

                    if (apiKey) {
                        txtApiKey.value = apiKey;
                    } else {
                        console.log('[SETTINGS] API key unavailable.');
                    }
                });
            }

            function setValues() {
                Homey.set('ufv_nvr_ip', txtNvrIp.value, function (err, result) {
                    if (err) {
                        return Homey.alert(err);
                    }
                    console.log('[SETTINGS] NVR ip set: ' + result);
                });

                Homey.set('ufv_apikey', txtApiKey.value, function (err, result) {
                    if (err) {
                        return Homey.alert(err);
                    }
                    console.log('[SETTINGS] API key set: ' + result);
                });
            }

            btnApply.addEventListener('click', function (e) {
                setValues();
            });

            getValues();
        }
    </script>
</body>

</html>